#learn how to configure zonerama to fit your needs

## Terms used ##

  * Monitor: this is a camera from Zoneminder
  * Merged Image: the images that contian one or more recorded images from other zoneminder monitors. This is the output of Zonerama.
  * Merged Monior: this is where the images generated by zonerama go to. it is a dummy-monitor in zoneminder to allow you to view the merged images using the zoneminder web interface.
  * Linked Monitor: A monitor from zoneminder used as source for the Merged Monitor.
  * monitorId: the Id of the zoneminder monitor. you can get it from looking at the zoneminder urls (parameter mid) or from the "Monitors" Database table.

## Sample Config ##

zonerama uses the file zonerama.conf for configuration. This file defines some paths and what monitors are to merge to where.

Here is a sample configuration file that merges two zoneminder monitors of the size 640x480 side by side.

```
{
        "zoneMinderConfigFile": "/usr/local/etc/zm.conf",
        "zoneMinderEventsDir": "/root/workspace/zm/events/",


        "mergedMonitors":
        [
                {
                        "monitorId": 3,
                        "outputImageHeight": 480,
                        "outputImageWidth": 640*2,
                        "maxLength": 1200,
                        "maxTimeBetweenEvents": 300,

                        //generate video options
                        "generateVideo": true,
                        "ffmpegCommand": "/usr/bin/ffmpeg",
                        "ffmpegArguments": "-f image2 -r 20 -i %1 %2",
                        "deleteFramesAfterGenerateVideoFromDB": true,
                        "deleteFramesAfterGenerateVideoFromHDD": true,
                        "maxFPS": 3,

                        "linkedMonitors":
                        [
                                {
                                        "linkedMonitorId": 1,
                                        "offsetVertical": 0,
                                        "offsetHorizontal": 0,
                                        "outputImageWidth": 640,
                                        "outputImageHeight": 480,
                                        "deleteMergedFramesFromDB": true,
                                        "deleteMergedFramesFromHDD": true,
                                },
                                {
                                        "linkedMonitorId": 2,
                                        "offsetVertical": 0,
                                        "offsetHorizontal": 640,
                                        "outputImageWidth": 640,
                                        "outputImageHeight": 480,
                                        "deleteMergedFramesFromDB": true,
                                        "deleteMergedFramesFromHDD": true,
                                }
                        ]

                }
        ]
}
```

The file uses json syntax, known from javascript. you are able to add comments, do calculations or even add javascript code.

for the early development state of zonerama, expect all parameters as required if they are not stated as optional.

this is what the output of this file looks like (with the responsible configuration options added):

![http://rw23.de/zonerama/419-capture-config-scaled.jpg](http://rw23.de/zonerama/419-capture-config-scaled.jpg)


---


## global options ##


### zoneMinderConfigFile ###
this defines the path of the Zoneminder config file. Zonerama takes the database creditials and other informations from it.

### zoneMinderEventsDir ###
the full path of the Zoneminder events dir


---


## mergedMonitors ##
this section defines your merged monitors. You may specify as many as you want. zonerama does currently process them not in parallel, so if you want that, you have to use two independent copys of Zonerama.

Each monitor definition is encapsolated by { and }. If you specify more than one, you have to seperate them with ",".



### monitorId ###
the id of the "merged" monitor where you want the resulting pictures go to. **This must be a existing zoneminder monitor id.** Just add a new monitor to zoneminder and configure it as:
  * Source: Local
  * Function: None
  * set width and height to equal outputImageHeight/Width so zoneminder displays it corrently in the webinterface.

### outputImageHeight and outputImageWidth ###
This sets the size of the created images.

### maxLength ###
this is the maximum length of merged event in seconds. this defines how many frames are processed in one run and get assigned to the newly created merged event. If you use the videogeneration feature, it also defines the maximum length of the resulting videos.
**If you use a maxLength greater than 600 seconds, be sure to set max\_allowed\_packet and group\_concat\_max\_len in MySQL configuration to a larger value. See [Requirements](Requirements.md) page for details.**


### maxTimeBetweenEvents ###
in a merged monitor, all events from the source monitors get merged into one so-called merged event. this defines the maximum time between merged events. if this limit is exeeded, zonerama will close the current merged event if there is no pictures for the defined amount of seconds.

### maxFPS (optional) ###
if this option is NOT specified, the resulting video framerate equals the maximum framerate of the source monitors. so if you have one camera at 3 fps and one at 30, the resulting video will also have 30 fps. high fps cause a lot load on your system, so you may want to limit the framerate of the resulting video.

### forceFPS (optional) ###
similar to maxFPS, but this forces the framerate to a exact value. i.e. if you have two camers running at 3 fps and set forceFPS to 5, the resulting video will always have 5 FPS.

### generateVideo ###
if this is set to true, zonerama will launch ffmpeg (or any other programm you want) to create a video out of the newly created merged images.

### ffmpegCommand and ffmpegArguments ###
Only usefull when generateVideo is set to true. this specifies the path to the ffmpeg binary and the parameters to use. %1 is a placeholder for the input files and %2 for the output. you may i.e. add -threads 4 to use more than one cpu core for rendering.

### deleteFramesAfterGenerateVideoFromDB ###
Only usefull when generateVideo is set to true. if deleteFramesAfterGenerateVideoFromDB is set to true, zonerama will delete the merged frames from the database (or to be more exactly, never add them to it).

### deleteFramesAfterGenerateVideoFromHDD ###
after ffmpeg did finish creating a video out of the merged images, delete them to free up disk space.


---


## linkedMonitors ##
This is a subsection of a merged monitor (see example). you have to add one for every source camera that sould be merged.


### linkedMonitorId ###
the id of the source monitor.

### offsetVertical ###
this defines how many pixel the image is shifted to right if it starts at the left upper corner.

### offsetHorizontal ###
this defines how many pixel the image is shifted down.

### (optional) outputImageWidth and outputImageHeight ###
if you want to rescale the source images, set the target size here. set to -1 or equal the original size of you dont want to scale. Note that scaling costs cpu resources, so set these options only of you really want.

### deleteMergedFramesFromDB ###
if set to true, this option will remove frame entries from the database after they were successfully merged. **zonerama will start rendering at the earliest available frames stored in the database, so if you set this to false, zonerama will render the same frames every time you run it.** usefull for testing your configuration if you also set deleteMergedFramesFromHDD to false. this may be improved in future versions of zonerama, create a feature request if you need this.

### deleteMergedFramesFromHDD ###
set this to true if you want the source images to be deleted from the HDD after they were successfully merged into a merged image.

### holdLastPictureForSeconds (optional) ###
if some of your monitors show no picture for one second, this option can be used to keep the last available picture for some seconds. the no-picture-for-one-second-problem happens when using cameras with low fps output. sometimes, they just dont send a picture for a second, so in that second, the camera has no picture in the video.

### standByImagePath (optional) ###
you can specify a image for each monitor that will be shown if no recorded picture is available.